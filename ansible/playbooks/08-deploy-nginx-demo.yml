---
- name: Deploy Nginx demo application via ArgoCD
  hosts: localhost
  connection: local
  become: no
  tasks:
    - name: Deploy Nginx ArgoCD application
      shell: |
        kubectl apply -f ../applications/nginx/argocd-application.yaml

    - name: Start Nginx port-forward
      shell: |
        kubectl port-forward svc/nginx-demo-service 30080:80 &
        echo "Nginx port-forward started on port 30080"

    - name: Wait for Nginx deployment to be ready
      shell: kubectl wait --for=condition=available deployment/nginx-demo -n default --timeout=300s

    - name: Display Nginx access information
      debug:
        msg: |
          Nginx demo application deployed successfully!
          Access via port-forward: http://localhost:30080
          (Kind 環境需要 port-forward，一般 K8s 環境可直接訪問 NodePort)
